---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title="Blog - Jeff Smolinski">
  <Navbar />

  <div class="container py-5">
    <h1 class="display-4 mb-4">Blog</h1>
    <p class="lead text-muted mb-5">Thoughts on security, development, and technology.</p>

    <div class="row">
      {posts.map((post) => (
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100">
            {post.data.heroImage && (
              <img src={post.data.heroImage} class="card-img-top" alt={post.data.title} style="height: 180px; object-fit: cover;" />
            )}
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{post.data.title}</h5>
              <p class="card-text text-muted small">
                {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
              </p>
              <p class="card-text flex-grow-1">{post.data.description}</p>
              <div class="mb-2">
                {post.data.tags.map((tag) => (
                  <span class="badge badge-secondary mr-1">{tag}</span>
                ))}
              </div>
              <a href={`/blog/${post.slug}`} class="btn btn-info mt-auto">Read More</a>
            </div>
          </div>
        </div>
      ))}
    </div>

    {posts.length === 0 && (
      <p class="text-muted">No blog posts yet. Check back soon!</p>
    )}
  </div>

  <Footer />
</BaseLayout>
